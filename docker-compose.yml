version: "3.9"

services:

  mosquitto:
    image: eclipse-mosquitto:latest
    container_name: mosquitto
    restart: unless-stopped
    ports:
      - "${MQTT_PORT:-1883}:1883"
    volumes:
      - ./mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf:ro
      - ./mosquitto/data:/mosquitto/data
      - ./mosquitto/log:/mosquitto/log
    networks:
      - parking_net

  frigate:
    image: ghcr.io/blakeblackshear/frigate:stable
    container_name: frigate
    restart: unless-stopped
    depends_on:
      - mosquitto
    shm_size: "512mb"
    ports:
      - "${FRIGATE_HTTP_PORT:-5000}:5000"
      - "${FRIGATE_RTSP_PORT:-8554}:8554"
    volumes:
      - ./frigate/config.yml:/config/config.yml:ro
      - ./frigate/media:/media/frigate
      - /dev/shm:/dev/shm
    networks:
      - parking_net

  homeassistant:
    image: ghcr.io/home-assistant/home-assistant:stable
    container_name: homeassistant
    restart: unless-stopped
    depends_on:
      - mosquitto
      - frigate
      - codeproject-ai
    ports:
      - "${HA_PORT:-8123}:8123"
    volumes:
      - ./homeassistant:/config
      - /etc/localtime:/etc/localtime:ro
    networks:
      - parking_net

  esphome:
    image: ghcr.io/esphome/esphome:stable
    container_name: esphome
    restart: unless-stopped
    ports:
      - "${ESPHOME_PORT:-6052}:6052"
    volumes:
      - ./esphome:/config
      - /etc/localtime:/etc/localtime:ro
    devices:
      - /dev/ttyUSB0:/dev/ttyUSB0
    privileged: true
    networks:
      - parking_net

  codeproject-ai:
    image: codeproject/ai-server:latest
    container_name: codeproject-ai
    restart: unless-stopped
    ports:
      - "${ALPR_PORT:-32168}:32168"
    networks:
      - parking_net


networks:
  parking_net:
    driver: bridge
